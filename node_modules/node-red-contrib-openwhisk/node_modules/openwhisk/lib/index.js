'use strict';

var _request = require('request');

var _request2 = _interopRequireDefault(_request);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Base64 = require('js-base64').Base64;

module.exports = function (org, space, action, key, body) {
  var blocking = arguments.length <= 5 || arguments[5] === undefined ? true : arguments[5];

  var url = 'https://openwhisk.ng.bluemix.net/api/v1/namespaces/' + org + '_' + space + '/actions/' + action + '?blocking=' + blocking;
  var encodedKey = Base64.encode(key);

  var config = {
    url: url,
    method: 'post',
    json: true,
    body: body,
    headers: { 'Authorization': 'Basic ' + encodedKey }
  };

  return new _bluebird2.default(function (resolve, reject) {
    (0, _request2.default)(config, function (err, response, body) {
      if (err) {
        reject({ err: err, response: response });
      } else {
        resolve(body);
      }
    });
  });
};